# 🎟️ User Stories — 콘서트 예약 시스템

## 1. 대기열 시스템 (Queue System)

### 🧍‍♂️ User Story 1 — 토큰 발급
**As a** 콘서트 방문자  
**I want** 예약 페이지에 접속하면 대기열 토큰을 발급받고 싶다  
**So that** 공정하고 순서에 맞게 대기열에 참여할 수 있다

**Acceptance Criteria**
- 사용자가 예약 페이지에 접근하면 고유한 대기열 토큰이 발급된다.
- 발급된 토큰에는 30분의 유효 기간이 설정된다.
- 토큰이 만료되면 대기열 및 예약 기능을 이용할 수 없다.

---

### 🧍‍♀️ User Story 2 — 대기 순서 확인
**As a** 대기 중인 사용자  
**I want** 내 대기 순서와 남은 대기 시간을 확인하고 싶다  
**So that** 언제 예약을 진행할 수 있는지 알 수 있다

**Acceptance Criteria**
- 사용자는 대기열 토큰으로 자신의 순서를 확인할 수 있다.
- 대기열은 요청 도착 순서대로 순번이 배정된다.
- 시스템은 10초마다 10명의 사용자를 입장시킨다.

---

### 👮‍♂️ User Story 3 — 동시 입장 제한
**As a** 시스템  
**I want** 동시에 입장 가능한 사용자를 500명으로 제한하고 싶다  
**So that** 서버의 안정성과 성능을 유지할 수 있다

**Acceptance Criteria**
- 대기열을 통과한 사용자가 500명 이상이면 새로운 입장은 중단된다.
- 대기열은 계속 유지되며, 입장 가능한 인원이 생길 때까지 대기한다.

---

## 2. 좌석 예약 시스템 (Seat Reservation System)

### 🎫 User Story 4 — 좌석 상태 조회
**As a** 유효한 토큰을 가진 사용자  
**I want** 모든 좌석의 상태를 조회하고 싶다  
**So that** 예약 가능한 좌석을 선택할 수 있다

**Acceptance Criteria**
- 사용자는 유효한 토큰으로만 좌석 상태를 조회할 수 있다.
- 좌석은 `AVAILABLE`, `TEMP_RESERVED`, `RESERVED` 상태 중 하나로 표시된다.
- `AVAILABLE` 좌석만 선택할 수 있다.

---

### 🪑 User Story 5 — 임시 좌석 예약
**As a** 유효한 토큰을 가진 사용자  
**I want** 좌석을 임시로 예약하고 싶다  
**So that** 결제를 진행하는 동안 다른 사람에게 좌석이 빼앗기지 않도록 하고 싶다

**Acceptance Criteria**
- 좌석을 선택하면 `AVAILABLE → TEMP_RESERVED` 로 변경된다.
- 좌석은 한 번에 한 명만 임시 예약할 수 있다.
- 이미 `TEMP_RESERVED` 또는 `RESERVED` 상태인 좌석은 예약할 수 없다.
- 토큰이 만료된 사용자가 임시 예약을 시도하면 에러를 반환한다.

---

### 💰 User Story 6 — 결제 및 예약 확정
**As a** 임시로 좌석을 예약한 사용자  
**I want** 결제를 완료하고 싶다  
**So that** 내 좌석이 확정되어 예약이 완료되도록 하고 싶다

**Acceptance Criteria**
- 결제가 성공하면 좌석 상태는 `TEMP_RESERVED → RESERVED` 로 변경된다.
- 결제 시 사용자의 잔액이 차감된다.
- 결제가 완료되면 해당 사용자의 대기열 토큰이 만료 처리된다.
- 결제가 실패하면 좌석 상태는 다시 `AVAILABLE` 로 복구된다.

---

## 3. 토큰 및 타임아웃 정책 (Token & Timeout)

### ⏳ User Story 7 — 토큰 만료 처리
**As a** 시스템  
**I want** 발급된 토큰이 30분이 지나면 자동으로 만료되도록 하고 싶다  
**So that** 비활성 사용자가 대기열과 예약 시스템에서 제거되도록 하고 싶다

**Acceptance Criteria**
- 토큰은 발급 시점으로부터 30분 후 자동 만료된다.
- 만료된 토큰으로는 좌석 조회, 임시 예약, 결제 요청이 불가능하다.
- 토큰 만료 시 임시 예약된 좌석은 자동으로 `AVAILABLE` 상태로 돌아간다.

---

### 🔁 User Story 8 — 임시 예약 타임아웃
**As a** 시스템  
**I want** 일정 시간이 지나거나 토큰이 만료되면 임시 예약 좌석을 해제하고 싶다  
**So that** 다른 사용자가 해당 좌석을 다시 예약할 수 있도록 하고 싶다

**Acceptance Criteria**
- 임시 예약된 좌석은 결제가 제한 시간 내 완료되지 않으면 자동으로 해제된다.
- 해제 시 좌석 상태는 `TEMP_RESERVED → AVAILABLE` 로 전환된다.
- 만료된 토큰과 연결된 임시 예약 좌석도 동일하게 해제된다.  